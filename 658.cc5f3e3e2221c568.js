"use strict";(self.webpackChunkspa_angular_typescript_hello_world=self.webpackChunkspa_angular_typescript_hello_world||[]).push([[658],{658:(gS,y2,n)=>{n.r(y2),n.d(y2,{PolylogModule:()=>uS});var V=n(6895),o7=n(1316),n7=n(5477),R=n(5861),P2=n(7579),H7=n(4986),t7=n(4482),z7=n(5403),V7=n(2722),v7=n(6805),M7=n(930);function T2(r,f){const a="object"==typeof f;return new Promise((e,s)=>{const i=new M7.Hp({next:l=>{e(l),i.unsubscribe()},error:s,complete:()=>{a?e(f.defaultValue):s(new v7.K)}});r.subscribe(i)})}var g4={prefix:"fas",iconName:"cloud-arrow-up",icon:[640,512,[62338,"cloud-upload","cloud-upload-alt"],"f0ee","M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"]},t=n(9749),k2=n(5084),c=n(4650),m=n(5247),WN=n(7185),IN=n(1481),ON=n(2164);const ZN=["fileInput"],QN=["commentDialog"],JN=["draggableCommentElement"],KN=["draggableMediaElement"];function XN(r,f){1&r&&(c.TgZ(0,"div",20),c._uU(1," Datei wird hochgeladen "),c._UZ(2,"span",21),c.qZA())}function $N(r,f){if(1&r){const a=c.EpF();c.TgZ(0,"button",12),c.NdJ("click",function(){c.CHM(a),c.oxw();const s=c.MAs(8);return c.KtG(s.click())}),c.O4$(),c.TgZ(1,"svg",22),c._UZ(2,"path",23),c.qZA(),c.kcU(),c.TgZ(3,"span",24),c._uU(4,"Datei hochladen"),c.qZA()()}}function YN(r,f){if(1&r){const a=c.EpF();c.TgZ(0,"button",12),c.NdJ("click",function(){c.CHM(a);const s=c.oxw(2);return c.KtG(s.uploadMedia())}),c.O4$(),c.TgZ(1,"svg",22),c._UZ(2,"path",23),c.qZA(),c.kcU(),c.TgZ(3,"span",24),c._uU(4),c.qZA()()}if(2&r){const a=c.oxw(2);c.xp6(4),c.hij(" ",a.selectedMedia.name," ")}}function jN(r,f){if(1&r){const a=c.EpF();c.TgZ(0,"button",12),c.NdJ("click",function(){c.CHM(a);const s=c.oxw(2);return c.KtG(s.cancelUpload())}),c._uU(1," Abbrechen "),c.qZA()}}function cS(r,f){if(1&r){const a=c.EpF();c.TgZ(0,"div",11)(1,"button",12),c.NdJ("click",function(){c.CHM(a);const s=c.oxw();return c.KtG(s.openDialog())}),c.O4$(),c.TgZ(2,"svg",13),c._UZ(3,"path",14),c.qZA(),c.kcU(),c.TgZ(4,"span",15),c._uU(5,"Kommentieren"),c.qZA()(),c.YNc(6,XN,3,0,"div",16),c.TgZ(7,"input",17,18),c.NdJ("change",function(s){c.CHM(a);const i=c.oxw();return c.KtG(i.onMediaSelected(s))}),c.qZA(),c.YNc(9,$N,5,0,"button",19),c.YNc(10,YN,5,1,"button",19),c.YNc(11,jN,2,0,"button",19),c.qZA()}if(2&r){const a=c.oxw();c.xp6(6),c.Q6J("ngIf",a.mediaisLoading),c.xp6(3),c.Q6J("ngIf",!a.selectedMedia&&a.hasFileUploadAccess),c.xp6(1),c.Q6J("ngIf",a.selectedMedia&&a.hasFileUploadAccess),c.xp6(1),c.Q6J("ngIf",a.selectedMedia)}}function aS(r,f){if(1&r&&(c.TgZ(0,"h1",25),c._uU(1),c.qZA()),2&r){const a=c.oxw();c.xp6(1),c.Oqu(a.forschungsfrage)}}function eS(r,f){if(1&r&&c._UZ(0,"img",26),2&r){const a=c.oxw();c.Q6J("src",a.imagePath,c.LSH)}}function sS(r,f){1&r&&c.GkF(0)}const iS=function(r){return{$implicit:r}};function rS(r,f){if(1&r&&(c.ynx(0),c.YNc(1,sS,1,0,"ng-container",27),c.BQk()),2&r){const a=f.$implicit;c.oxw();const e=c.MAs(11);c.xp6(1),c.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",c.VKq(2,iS,a))}}function lS(r,f){if(1&r){const a=c.EpF();c.O4$(),c.TgZ(0,"svg",33),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.deleteMedia(s))}),c._UZ(1,"path",34),c.qZA()}}function fS(r,f){if(1&r&&c._UZ(0,"img",35),2&r){const a=c.oxw().$implicit;c.Q6J("src",a.blobStorageUri,c.LSH)}}const A2=function(){return{}};function oS(r,f){if(1&r&&(c.TgZ(0,"div",28,29)(2,"div",30),c.YNc(3,lS,2,0,"svg",31),c.qZA(),c.YNc(4,fS,1,1,"img",32),c.qZA()),2&r){const a=f.$implicit,e=c.oxw();c.Q6J("ngStyle",a.id?e.mediaPositions[a.id]:c.DdM(4,A2)),c.uIk("data-file-id",a.id),c.xp6(3),c.Q6J("ngIf",a.blobStorageUri&&e.isImage(a.blobStorageUri)),c.xp6(1),c.Q6J("ngIf",a.blobStorageUri&&e.isImage(a.blobStorageUri))}}function nS(r,f){if(1&r&&(c.TgZ(0,"video",39),c._UZ(1,"source",40),c.qZA()),2&r){const a=c.oxw().$implicit;c.xp6(1),c.Q6J("src",a.blobStorageUri,c.LSH)}}function HS(r,f){if(1&r){const a=c.EpF();c.O4$(),c.TgZ(0,"svg",41),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.deleteMedia(s))}),c._UZ(1,"path",42),c.qZA()}}function tS(r,f){if(1&r&&(c.TgZ(0,"div",36,29),c.YNc(2,nS,2,1,"video",37),c.YNc(3,HS,2,0,"svg",38),c.qZA()),2&r){const a=f.$implicit,e=c.oxw();c.Q6J("ngStyle",a.id?e.mediaPositions[a.id]:c.DdM(4,A2)),c.uIk("data-file-id",a.id),c.xp6(2),c.Q6J("ngIf",a.blobStorageUri&&e.isVideo(a.blobStorageUri)),c.xp6(1),c.Q6J("ngIf",a.blobStorageUri&&e.isVideo(a.blobStorageUri))}}function zS(r,f){if(1&r){const a=c.EpF();c.O4$(),c.TgZ(0,"svg",46),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.deleteMedia(s))}),c._UZ(1,"path",34),c.qZA()}}function mS(r,f){if(1&r&&(c.TgZ(0,"audio",47),c._UZ(1,"source",48),c.qZA()),2&r){const a=c.oxw().$implicit;c.xp6(1),c.Q6J("src",a.blobStorageUri,c.LSH)}}function VS(r,f){if(1&r&&(c.TgZ(0,"div",43,29),c.YNc(2,zS,2,0,"svg",44),c.YNc(3,mS,2,1,"audio",45),c.qZA()),2&r){const a=f.$implicit,e=c.oxw();c.Q6J("ngStyle",a.id?e.mediaPositions[a.id]:c.DdM(4,A2)),c.uIk("data-file-id",a.id),c.xp6(2),c.Q6J("ngIf",a.blobStorageUri&&e.isAudio(a.blobStorageUri)),c.xp6(1),c.Q6J("ngIf",a.blobStorageUri&&e.isAudio(a.blobStorageUri))}}function vS(r,f){if(1&r){const a=c.EpF();c.O4$(),c.kcU(),c.TgZ(0,"div",59)(1,"button",60),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.editKommentar(s.id))}),c._uU(2,"Bearbeiten"),c.qZA(),c.TgZ(3,"button",60),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.openReplyDialog(s.id))}),c._uU(4,"Antworten"),c.qZA(),c.TgZ(5,"button",60),c.NdJ("click",function(){c.CHM(a);const s=c.oxw().$implicit,i=c.oxw();return c.KtG(i.deleteKommentar(s.id))}),c._uU(6,"L\xf6schen"),c.qZA()()}if(2&r){const a=c.oxw().isReply,e=c.oxw();c.ekj("menu",!a)("reply-menu",a)("show",e.isMenuOpen)}}function MS(r,f){1&r&&c.GkF(0)}const hS=function(r){return{$implicit:r,isReply:!0}};function CS(r,f){if(1&r&&(c.ynx(0,62),c.YNc(1,MS,1,0,"ng-container",27),c.BQk()),2&r){const a=f.$implicit;c.oxw(3);const e=c.MAs(11);c.xp6(1),c.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",c.VKq(2,hS,a))}}function pS(r,f){if(1&r&&(c.O4$(),c.kcU(),c.TgZ(0,"div"),c.YNc(1,CS,2,4,"ng-container",61),c.qZA()),2&r){const a=c.oxw().$implicit,e=c.oxw();c.xp6(1),c.Q6J("ngForOf",a.replies)("ngForTrackBy",e.trackById)}}function LS(r,f){if(1&r){const a=c.EpF();c.TgZ(0,"div",49,50)(2,"div",51)(3,"h4"),c._uU(4),c.qZA(),c._UZ(5,"p",52),c.TgZ(6,"p",53),c._uU(7),c.ALo(8,"date"),c.qZA(),c._UZ(9,"br"),c.TgZ(10,"div",54),c.O4$(),c.TgZ(11,"svg",55),c.NdJ("click",function(){const i=c.CHM(a).$implicit,l=c.oxw();return c.KtG(l.toggleMenu(i.id))}),c._UZ(12,"path",56),c.qZA(),c.YNc(13,vS,7,6,"div",57),c.qZA()()(),c.YNc(14,pS,2,2,"div",58)}if(2&r){const a=f.$implicit,e=f.isReply,s=c.oxw();c.ekj("commentar",!e)("replies",e),c.Q6J("ngStyle",a.style),c.uIk("data-comment-id",a.id),c.xp6(4),c.Oqu(a.title),c.xp6(1),c.Q6J("innerHTML",s.getSafeHtml(a.comment),c.oJD),c.xp6(2),c.Oqu(c.lcZ(8,11,a.createdAt)),c.xp6(6),c.Q6J("ngIf",s.isMenuOpen&&s.activeCommentId===a.id),c.xp6(1),c.Q6J("ngIf",a.replies&&a.replies.length)}}t.p8.registerPlugin(k2.Z);let dS=(()=>{class r{constructor(a,e,s,i,l,o,H,z,D){this.forschungsfrageService=a,this.freezePolylogService=e,this.roleService=s,this.toastr=i,this.sanitizer=l,this.mediaService=o,this.commentPositionService=H,this.mediaPositionService=z,this.kommentarService=D,this.faCloudUploadAlt=g4,this.forschungsfrage="",this.selectedMediaName="",this.selectedMedia=null,this.isUploaded=!1,this.freezePolylog=!1,this.icon="upload",this.isMenuOpen=!1,this.activeCommentId=null,this.kommentare=[],this.mediaFiles=[],this.mediaUrls=[],this.isAdmin=!1,this.role=null,this.hasFileUploadAccess=!1,this.videoPositions={},this.imagePositions={},this.audioPositions={},this.imageUrls=[],this.videoUrls=[],this.audioUrls=[],this.mediaisLoading=!1,this.positionUpdateSubject=new P2.x,this.destroy$=new P2.x,this.errorMessage="Fehler beim laden der Forschungsfrage.",this.isDialogOpen=!1,this.commentPositions={},this.mediaPositions={}}isImage(a){return null!=a.match(/\.(jpeg|jpg|gif|png)$/)}isVideo(a){return null!=a.match(/\.(mp4|webm)$/)}isAudio(a){return null!=a.match(/\.(mp3|wav)$/)}ngOnInit(){var a=this;return(0,R.Z)(function*(){a.fetchLatestForschungsfrage(),a.listenForNewForschungsfrage(),a.loadKommentare(),a.setupPositionUpdates(),yield Promise.all([a.loadCommentPositions(),a.loadMediaPositions()]),a.freezePolylogService.getFreezeState().subscribe(e=>{a.freezePolylog=e}),a.role=a.roleService.getRole(),a.isAdmin="true"===localStorage.getItem("isAdmin"),("Team"===a.role||"K\xfcnstler"===a.role)&&(a.hasFileUploadAccess=!0)})()}ngOnDestroy(){this.forschungsfragenSubscription?.unsubscribe(),this.destroy$.next(),this.destroy$.complete()}ngAfterViewInit(){this.isAdmin&&this.initializeDraggable()}setupPositionUpdates(){this.positionUpdateSubject.pipe(function m7(r,f=H7.z){return(0,t7.e)((a,e)=>{let s=null,i=null,l=null;const o=()=>{if(s){s.unsubscribe(),s=null;const z=i;i=null,e.next(z)}};function H(){const z=l+r,D=f.now();if(D<z)return s=this.schedule(void 0,z-D),void e.add(s);o()}a.subscribe((0,z7.x)(e,z=>{i=z,l=f.now(),s||(s=f.schedule(H,r),e.add(s))},()=>{o(),e.complete()},void 0,()=>{i=s=null}))})}(300),(0,V7.R)(this.destroy$)).subscribe(a=>{"kommentarId"in a?this.saveCommentPosition(a):"fileModelId"in a&&this.saveMediaPosition(a)})}loadCommentPositions(){var a=this;return(0,R.Z)(function*(){try{(yield T2(a.commentPositionService.getCommentPositions())).forEach(s=>{a.commentPositions[s.kommentarId]=s}),console.log("Loaded positions:",a.commentPositions)}catch(e){console.error("Error loading comment positions:",e)}})()}loadMediaPositions(){var a=this;return(0,R.Z)(function*(){try{(yield T2(a.mediaPositionService.getMediaPositions())).forEach(s=>{a.mediaPositions[s.fileModelId]=s}),console.log("Loaded media positions:",a.mediaPositions)}catch(e){console.error("Error loading media positions:",e)}})()}editKommentar(a){}onMediaSelected(a){this.selectedMedia=a.target.files[0],this.selectedMedia&&(this.selectedMediaName=this.selectedMedia.name)}cancelUpload(){this.selectedMedia=null,this.selectedMediaName="",this.fileInput.nativeElement.value=""}uploadMedia(){this.selectedMedia&&null!==this.currentForschungsfrageId?(this.mediaisLoading=!0,this.mediaService.uploadMedia(this.selectedMedia,this.currentForschungsfrageId).subscribe({next:a=>{this.toastr.success("Medium erfolgreich hochgeladen!"),this.selectedMedia=null,this.selectedMediaName="",this.mediaisLoading=!1,this.fetchMediaFiles()},error:a=>{this.toastr.error("Fehler beim Hochladen des Mediums."),console.error("Error uploading media:",a),this.mediaisLoading=!1}})):this.toastr.warning("Bitte w\xe4hle eine Datei zum Upload aus.")}fetchLatestForschungsfrage(){this.forschungsfrageService.getLatestForschungsfrage().subscribe({next:a=>{this.forschungsfrage=a.title,this.imagePath=a.imagePath,this.currentForschungsfrageId=a.id,this.clearKommentare(),this.fetchMediaFiles(),console.log("Forschungsfrage updated. ID:",this.currentForschungsfrageId)},error:()=>{this.forschungsfrage=this.errorMessage}})}listenForNewForschungsfrage(){this.forschungsfragenSubscription=this.forschungsfrageService.forschungsfragen$.subscribe(()=>{this.currentForschungsfrageId&&this.fetchLatestForschungsfrage()})}openDialog(a){this.isDialogOpen=!0,this.commentDialog.parentKommentarId=a,this.draggableElements.forEach(e=>{t.p8.set(e.nativeElement,{zIndex:890})})}openReplyDialog(a){this.openDialog(a),this.draggableElements.forEach(e=>{t.p8.set(e.nativeElement,{zIndex:790})}),this.isMenuOpen=!1}closeDialog(){this.isDialogOpen=!1}toggleMenu(a){this.isMenuOpen=this.activeCommentId!==a||!this.isMenuOpen,this.activeCommentId=a}getSafeHtml(a){return a?this.sanitizer.bypassSecurityTrustHtml(a):""}clearKommentare(){this.kommentare=[]}onCommentSubmitted(a){if(a){if(null==a.parentKommentarId)this.kommentare.push(a);else{const e=this.kommentare.find(s=>s.id===a.parentKommentarId);e&&(e.replies||(e.replies=[]),e.replies.push(a))}this.loadKommentare()}}addReplyToKommentar(a,e,s){for(let i of a){if(i.id===e.parentKommentarId)return i.replies||(i.replies=[]),void i.replies.push(this.assignRandomPosition(e,s));i.replies&&i.replies.length&&this.addReplyToKommentar(i.replies,e,s)}}fetchMediaFiles(){this.mediaService.getAllMedia(this.currentForschungsfrageId).subscribe({next:a=>{this.mediaFiles=a,a&&a.length>0?(this.imageUrls=a.filter(e=>this.isImage(e.fileType)&&void 0!==e.blobStorageUri).map(e=>e.blobStorageUri),this.videoUrls=a.filter(e=>this.isVideo(e.fileType)&&void 0!==e.blobStorageUri).map(e=>e.blobStorageUri),this.audioUrls=a.filter(e=>this.isAudio(e.fileType)&&void 0!==e.blobStorageUri).map(e=>e.blobStorageUri),this.preCalculateMediaPositions(),setTimeout(()=>this.initializeDraggable(),0)):console.log("No media files found.")},error:a=>{console.error("Error fetching media:",a)}})}preCalculateMediaPositions(){this.videoUrls.forEach((a,e)=>{const s=Math.floor(Math.random()*window.innerWidth-250),i=Math.floor(Math.random()*window.innerHeight-850);this.videoPositions[e]={transform:`translateX(${s}px) translateY(${i}px)`}}),this.imageUrls.forEach((a,e)=>{const s=Math.floor(Math.random()*window.innerWidth-250),i=Math.floor(Math.random()*window.innerHeight-850);this.imagePositions[e]={transform:`translateX(${s}px) translateY(${i}px)`}}),this.audioUrls.forEach((a,e)=>{const s=Math.floor(Math.random()*window.innerWidth-250),i=Math.floor(Math.random()*window.innerHeight-850);this.audioPositions[e]={transform:`translateX(${s}px) translateY(${i}px)`}})}loadKommentare(){this.kommentarService.getAllKommentare().subscribe(a=>{this.kommentare=a.map(e=>this.assignRandomPosition(e)),setTimeout(()=>this.initializeDraggable(),0)})}deleteKommentar(a){this.kommentarService.deleteKommentar(a).subscribe(()=>{this.removeCommentById(this.kommentare,a)})}deleteMedia(a){const e=a.fileName?.split("/"),s=e[e.length-1],i=this.mediaFiles.findIndex(l=>l.id===a.id);i>-1&&this.mediaFiles.splice(i,1),this.mediaService.deleteMedia(s).subscribe({next:()=>{this.toastr.success("Medium erfolgreich gel\xf6scht.")},error:l=>{this.toastr.error("Fehler beim L\xf6schen des Mediums."),console.error("Error deleting media:",l),this.mediaFiles.splice(i,0,a)}})}removeCommentById(a,e){for(let s=0;s<a.length;s++){if(a[s].id===e){if(a[s].replies&&a[s].replies.length>0)for(let i of a[s].replies)this.removeCommentById(a[s].replies,i.id);return void a.splice(s,1)}a[s].replies&&this.removeCommentById(a[s].replies,e)}}trackById(a,e){return e.id}assignRandomPosition(a,e){const s=a,i=this.commentPositions[a.id],l=e||this.generateRandomColor();if(i)return{...s,style:{transform:`translateX(${i.xPosition}px) translateY(${Math.max(i.yPosition,0)}px)`,borderTop:`60px solid ${i.borderColor||l}`,borderRight:`60px solid ${i.borderColor||l}`,borderBottom:`30px solid ${i.borderColor||l}`,borderLeft:`20px solid ${i.borderColor||l}`,color:"#000000"}};const o=Math.floor(Math.random()*(window.innerWidth-250)),H=Math.floor(Math.random()*Math.max(window.innerHeight-1050,0));return{...s,style:{transform:`translateX(${o}px) translateY(${Math.max(H,0)}px)`,borderTop:`60px solid ${l}`,borderRight:`60px solid ${l}`,borderBottom:`30px solid ${l}`,borderLeft:`20px solid ${l}`,color:"#000000"}}}generateRandomColor(){let a="#";for(let e=0;e<3;e++)a+=Math.floor(256*Math.random()).toString(16).padStart(2,"0");return this.isColorUnacceptable(a)?this.generateRandomColor():a}isColorUnacceptable(a){const e=["#000000","#ffffff","#e21c52"];for(let i of e)if(this.getColorDistance(a,i)<150)return!0;return!1}getColorDistance(a,e){const s=this.hexToRgb(a),i=this.hexToRgb(e);if(!s||!i)return 0;let l=0;return l+=Math.pow(s.r-i.r,2),l+=Math.pow(s.g-i.g,2),l+=Math.pow(s.b-i.b,2),Math.sqrt(l)}onDragEnd(a,e){const s=e.target,o={kommentarId:a,xPosition:parseFloat(t.p8.getProperty(s,"x")),yPosition:parseFloat(t.p8.getProperty(s,"y")),borderColor:this.generateRandomColor()};console.log("Saving comment position:",o),this.commentPositionService.saveCommentPosition(o).subscribe({next:H=>{console.log("Comment position saved:",H)},error:H=>{console.error("Error saving comment position:",H)}})}hexToRgb(a){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}initializeDraggable(){this.initializeDraggableComments(),this.initializeDraggableMedia()}initializeDraggableComments(){this.draggableElements.forEach(a=>{const e=a.nativeElement,s=parseInt(e.getAttribute("data-comment-id"),10),i=this.commentPositions[s];i&&(t.p8.set(e,{x:i.xPosition,y:i.yPosition}),e.style.borderColor=i.borderColor||this.generateRandomColor()),k2.Z.create(e,{type:"x,y",bounds:window,inertia:!0,onDrag:()=>this.updatePosition(s,e),onDragEnd:()=>{this.updatePosition(s,e),t.p8.set(e,{zIndex:790})}})})}initializeDraggableMedia(){this.draggableMediaElements.forEach(a=>{const e=a.nativeElement,s=parseInt(e.getAttribute("data-file-id"),10),i=this.mediaPositions[s];i&&t.p8.set(e,{x:i.xPosition,y:i.yPosition}),k2.Z.create(e,{type:"x,y",bounds:window,inertia:!0,onDrag:()=>this.updateMediaPosition(s,e),onDragEnd:()=>this.updateMediaPosition(s,e)})})}updatePosition(a,e){const s=parseFloat(t.p8.getProperty(e,"x")),i=parseFloat(t.p8.getProperty(e,"y"));if(!isNaN(s)&&!isNaN(i)){const l={kommentarId:a,xPosition:s,yPosition:i,borderColor:e.style.borderColor||this.generateRandomColor()};this.positionUpdateSubject.next(l)}}updateMediaPosition(a,e){const s=parseFloat(t.p8.getProperty(e,"x")),i=parseFloat(t.p8.getProperty(e,"y"));isNaN(s)||isNaN(i)||!a||this.positionUpdateSubject.next({fileModelId:a,xPosition:s,yPosition:i})}onMediaDragEnd(a,e){const s=e.target,i=parseFloat(s.style.left||"0"),l=parseFloat(s.style.top||"0");this.mediaPositionService.saveMediaPosition({fileModelId:a,xPosition:i,yPosition:l}).subscribe({next:H=>{console.log("Media position saved:",H)},error:H=>{console.error("Error saving media position:",H)}})}saveCommentPosition(a){this.commentPositionService.saveCommentPosition(a).subscribe({next:e=>{console.log("Position saved:",e),this.commentPositions[a.kommentarId]=e},error:e=>console.error("Error saving position:",e)})}saveMediaPosition(a){this.mediaPositionService.saveMediaPosition(a).subscribe({next:e=>{console.log("Position saved:",e),this.mediaPositions[a.fileModelId]=e},error:e=>console.error("Error saving position:",e)})}loadPositions(){return new Promise((a,e)=>{let s=!1,i=!1;this.commentPositionService.getCommentPositions().subscribe(l=>{console.log("Comment Positions:",l),l.forEach(o=>{this.commentPositions[o.kommentarId]={kommentarId:o.kommentarId,xPosition:o.xPosition,yPosition:o.yPosition,borderColor:o.borderColor}}),s=!0,s&&i&&a()},l=>{console.error("Error loading comment positions:",l),e()}),this.mediaPositionService.getMediaPositions().subscribe(l=>{console.log("Media Positions:",l),l.forEach(o=>{this.mediaPositions[o.fileModelId]={fileModelId:o.fileModelId,xPosition:o.xPosition,yPosition:o.yPosition}}),i=!0,s&&i&&a()},l=>{console.error("Error loading media positions:",l),e()})})}}return r.\u0275fac=function(a){return new(a||r)(c.Y36(m.$G),c.Y36(m.Ih),c.Y36(m.Nj),c.Y36(WN._W),c.Y36(IN.H7),c.Y36(m.yJ),c.Y36(m.tb),c.Y36(m.wr),c.Y36(m.Z0))},r.\u0275cmp=c.Xpm({type:r,selectors:[["app-polylog"]],viewQuery:function(a,e){if(1&a&&(c.Gf(ZN,5),c.Gf(QN,5),c.Gf(JN,5),c.Gf(KN,5)),2&a){let s;c.iGM(s=c.CRH())&&(e.fileInput=s.first),c.iGM(s=c.CRH())&&(e.commentDialog=s.first),c.iGM(s=c.CRH())&&(e.draggableElements=s),c.iGM(s=c.CRH())&&(e.draggableMediaElements=s)}},decls:12,vars:9,consts:[["id","wrapper",2,"background-color","#ff9abc","overflow-x","hidden","height","100%"],["id","button-div",4,"ngIf"],["id","forschungsfrage",4,"ngIf"],["class","forschungsfrage-logo","alt","Uploaded Image","title","Das ist das Logo der Forschungsfrage",3,"src",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","image-div",3,"ngStyle",4,"ngFor","ngForOf"],["class","video-div","style","width: fit-content; height: 300px; background-color: none;",3,"ngStyle",4,"ngFor","ngForOf"],["class","audio-div",3,"ngStyle",4,"ngFor","ngForOf"],[3,"isOpen","close","commentSubmitted"],["commentDialog",""],["commentTemplate",""],["id","button-div"],[1,"comment-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-chat-right-text-fill"],["d","M16 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h9.586a1 1 0 0 1 .707.293l2.853 2.853a.5.5 0 0 0 .854-.353zM3.5 3h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1m0 2.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1m0 2.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1"],[2,"margin","0px 0px 10px 10px"],["class","loading-indicator","style","z-index:1000;",4,"ngIf"],["type","file","accept","image/*,video/*,audio/*",2,"display","none",3,"change"],["fileInput",""],["class","comment-button",3,"click",4,"ngIf"],[1,"loading-indicator",2,"z-index","1000"],[1,"loading-dots"],["xmlns","http://www.w3.org/2000/svg","width","20","height","20","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-cloud-arrow-up-fill",2,"margin-bottom","-5px"],["d","M8 2a5.53 5.53 0 0 0-3.594 1.342c-.766.66-1.321 1.52-1.464 2.383C1.266 6.095 0 7.555 0 9.318 0 11.366 1.708 13 3.781 13h8.906C14.502 13 16 11.57 16 9.773c0-1.636-1.242-2.969-2.834-3.194C12.923 3.999 10.69 2 8 2m2.354 5.146a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2a.5.5 0 0 1 .708 0z"],[2,"margin","-10px 0px 10px 10px"],["id","forschungsfrage"],["alt","Uploaded Image","title","Das ist das Logo der Forschungsfrage",1,"forschungsfrage-logo",3,"src"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"image-div",3,"ngStyle"],["draggableMediaElement",""],[1,"icon"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","black","class","bi bi-x-lg","viewBox","0 0 16 16",3,"click",4,"ngIf"],["alt","Uploaded Image","style","height:500px; width: 500px;",3,"src",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","black","viewBox","0 0 16 16",1,"bi","bi-x-lg",3,"click"],["d","M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"],["alt","Uploaded Image",2,"height","500px","width","500px",3,"src"],[1,"video-div",2,"width","fit-content","height","300px","background-color","none",3,"ngStyle"],["controls","","style","height: 300px; width: fit-content; margin:10px;",4,"ngIf"],["style","cursor: pointer; position: absolute; top: 15%; left: 5%;","xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","black","class","bi bi-x-lg","viewBox","0 0 16 16",3,"click",4,"ngIf"],["controls","",2,"height","300px","width","fit-content","margin","10px"],["type","video/mp4",3,"src"],["xmlns","http://www.w3.org/2000/svg","width","32","height","32","fill","black","viewBox","0 0 16 16",1,"bi","bi-x-lg",2,"cursor","pointer","position","absolute","top","15%","left","5%",3,"click"],["d","M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854z"],[1,"audio-div",3,"ngStyle"],["style","cursor: pointer; position: absolute; top: 10%; left: 20%; z-index: 450;","xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","black","class","bi bi-x-lg","viewBox","0 0 16 16",3,"click",4,"ngIf"],["controls","",4,"ngIf"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","black","viewBox","0 0 16 16",1,"bi","bi-x-lg",2,"cursor","pointer","position","absolute","top","10%","left","20%","z-index","450",3,"click"],["controls",""],["type","audio/mpeg",3,"src"],[1,"commentar-wrapper",3,"ngStyle"],["draggableCommentElement",""],[1,"commentar-content-wrapper"],[3,"innerHTML"],["id","date"],[1,"icons"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-three-dots",3,"click"],["d","M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3"],["class","menu",3,"menu","reply-menu","show",4,"ngIf"],[4,"ngIf"],[1,"menu"],[3,"click"],["class","replies",4,"ngFor","ngForOf","ngForTrackBy"],[1,"replies"]],template:function(a,e){1&a&&(c.TgZ(0,"div",0),c.YNc(1,cS,12,4,"div",1),c.YNc(2,aS,2,1,"h1",2),c.YNc(3,eS,1,1,"img",3),c.YNc(4,rS,2,4,"ng-container",4),c.YNc(5,oS,5,5,"div",5),c.YNc(6,tS,4,5,"div",6),c.YNc(7,VS,4,5,"div",7),c.TgZ(8,"app-comment-dialog",8,9),c.NdJ("close",function(){return e.closeDialog()})("commentSubmitted",function(i){return e.onCommentSubmitted(i)}),c.qZA(),c.YNc(10,LS,15,13,"ng-template",null,10,c.W1O),c.qZA()),2&a&&(c.xp6(1),c.Q6J("ngIf",!e.freezePolylog),c.xp6(1),c.Q6J("ngIf",!e.mediaisLoading),c.xp6(1),c.Q6J("ngIf",e.imagePath),c.xp6(1),c.Q6J("ngForOf",e.kommentare)("ngForTrackBy",e.trackById),c.xp6(1),c.Q6J("ngForOf",e.mediaFiles),c.xp6(1),c.Q6J("ngForOf",e.mediaFiles),c.xp6(1),c.Q6J("ngForOf",e.mediaFiles),c.xp6(1),c.Q6J("isOpen",e.isDialogOpen))},dependencies:[V.sg,V.O5,V.tP,V.PC,ON.E,V.uU],encapsulation:2}),r})(),uS=(()=>{class r{}return r.\u0275fac=function(a){return new(a||r)},r.\u0275mod=c.oAB({type:r}),r.\u0275inj=c.cJS({imports:[V.ez,n7.m,o7.Bz.forChild([{path:"",component:dS}])]}),r})()}}]);